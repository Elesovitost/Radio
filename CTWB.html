<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>CTWB</title>
  <style>
    .hidden-by-ctwb { display: none !important; }
  </style>
</head>
<body>
<script>
  // Naƒçten√≠ p≈Øvodn√≠ho FDGPET.html
  fetch('FDGPET.html')
    .then(r => r.text())
    .then(html => {

      // --- TEXTOV√â √öPRAVY ---
      html = html.replace(/PETCT/g, 'CTWB');
      html = html.replace(/PET \/ CT \(MR\)/g, 'CT');

      // odstranƒõn√≠ nepot≈ôebn√Ωch popisk≈Ø
      ['SUVmax jater', 'aktivace tuku', 'paravazace', 'nelaƒçnƒõn√≠'].forEach(txt => {
        const esc = txt.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const re  = new RegExp(esc + '(?:\\s|&nbsp;)*', 'g');
        html = html.replace(re, '');
      });

      //html = html.replace(/FDG\+ lo≈æisko/g, 'lo≈æisko');
      html = html.replace(/FDG\- nodul/g, 'nodul cyst.');
      html = html.replace(/FDG\+ nodul/g, 'nodul solid.');
      html = html.replace(/Recentn√≠ \(FDG\+\)/g, 'ƒåerstv√©');
      html = html.replace(/Star≈°√≠ \(FDG\-\)/g, 'Star≈°√≠');

      // p≈ôid√°n√≠ checkbox≈Ø
      html = html.replace(
        /(<div id="FDGPET"[^>]*>[\s\S]*?)(<\/div>)/i,
        `$1
          <label class="CHB ultrawide">
            <input type="checkbox" id="CTnadpisKRK" onChange="updateTexts()">
            <span>KRKU</span>
          </label>
          <label class="CHB ultrawide">
            <input type="checkbox" id="CTnadpisHRUDNIK" onChange="updateTexts()">
            <span>HRUDN√çKU</span>
          </label>
          <label class="CHB ultrawide">
            <input type="checkbox" id="CTnadpisBRICHO" onChange="updateTexts()">
            <span>B≈òICHA</span>
          </label>
        $2`
      );

      // --- ODSTRANƒöN√ç P≈ÆVODN√çHO SCRIPTU FDGPETpopis.js ---
      html = html.replace(/<script[^>]*src=["']FDGPETpopis\.js["'][^>]*><\/script>/i, '');

      // --- DOPLNƒöN√ç CSS ---
      html = html.replace(
        /<\/head>/i,
        `<style>
          #PETTypeButton { display:none !important; }
          #obecne > * { display:none !important; }
          #obecne > button.title { display:inline-block !important; }
          #obecne > label:has(#ChbRECIST) { display:inline-flex !important; }

          [id*="Lesion1SUV"],
          [id*="Lesion2SUV"],
          [id*="Lesion3SUV"],
          [id*="Lesion1Activity"],
          [id*="Lesion2Activity"],
          [id*="Lesion3Activity"] { display:none !important; }

          table:has(#NeckVCords),
          table:has(#HeadTonsils),
          table:has(#HeadTeeth),
          table:has(#ThoraxLNPlus),
          table:has(#SkeletonJoints) { display:none !important; }

          #NeckParotidstable table tr:has(#ChbParotidRavidLesion),
		  #NeckThyroidtable table tr:has(#ChbThyroidaviddiffuse),
          #ThoraxThymustable table tr:has(#ChbThoraxThymusAct),
          #ThoraxOesophtable table tr:has(#ChbOesophActDist),
          #ThoraxOesophtable table tr:has(#ChbOesophActDiff),
          #AbdomenSpleentable table tr:has(#ChbSpleenActivity),
          #AbdomenStomachtable table tr:has(#ChbStomachActivity),
          #AbdomenAdrenaltable table tr:has(#ChbAdrenalActivityR),
          #AbdomenWalltable table tr:has(#ChbAbdomenWallPlus),
          #AbdomenProstatetable table tr:has(#ChbProstateLesionR),
          #AbdomenOvariestable table tr:has(#ChbOvariesActivityR),
          #AbdomenUterustable table tr:has(#ChbUterusActivity),
          #SkeletonActivitytable table tr:has(#ChbSkeletonActivityPlus),
          #SkeletonActivitytable table tr:has(#ChbSkeletonActivityMinus)
          { display:none !important; }
        </style></head>`
      );

      // --- VLO≈ΩEN√ç UPRAVEN√âHO HTML ---
      document.open();
      document.write(html);
      document.close();

      // --- DODATEƒåN√â SKR√ùV√ÅN√ç ---
      const tryHide = () => {
        const btn = document.getElementById('PETTypeButton');
        if (btn) btn.classList.add('hidden-by-ctwb');
      };
      tryHide();
      const mo = new MutationObserver(() => tryHide());
      mo.observe(document.documentElement, { childList: true, subtree: true });

      const all = document.body.getElementsByTagName('*');
      for (let el of all) {
        const t = el.innerText || '';
        if (t.includes('1Activity') || t.includes('FDG') || t.includes('PET / CT (MR)')) {
          el.classList.add('hidden-by-ctwb');
        }
      }

// --- DYNAMICK√â NAƒåTEN√ç A √öPRAVA FDGPETpopis.js ---
      fetch('FDGPETpopis.js')
        .then(r => r.text())
        .then(js => {
          js = js.replace(/PETCT/g, 'CTWB');  // p≈ôepi≈° v≈°echny v√Ωskyty
		  
// HODNOCEN√ç
js = js.replace(/nem√° charakter viabiln√≠ neopl√°zie/g, 'nem√° charakter malignity');
js = js.replace(/suspektn√≠ z viabiln√≠ neopl√°zie/g, 'suspektn√≠ z malignity');
js = js.replace(/charakteru viabiln√≠ neopl√°zie/g, 'charakteru malignity');

//Do z√°vƒõru
js = js.replace(/\['na √∫rovni', 'nad √∫rovn√≠', 'intermed', 'st≈ôedn√≠', 'zv√Ω≈°en',  'vysok',  'hyper', 'vy≈°≈°√≠'\]/g,
"['o≈æisko', 'xpanze', 'odul', 'pacita', 'onsolidace',  'olekce',  'asa',  'nfiltrace',  'asa']");

//PETCT na CT
js = js.replace(/FDG-PET\/CT trupu/g, 'CT ');

js = js.replace(/let\s+CTparts\s*=\s*0\s*;/, `
(function adjustCTParts() {
  const parts = [];
  if (document.getElementById('CTnadpisKRK')?.checked)    parts.push("krku");
  if (document.getElementById('CTnadpisHRUDNIK')?.checked) parts.push("hrudn√≠ku");
  if (document.getElementById('CTnadpisBRICHO')?.checked)  parts.push("b≈ôicha");

  if (typeof nazev !== 'string') { try { window.nazev = String(nazev || ''); } catch(e) { window.nazev = ''; } }

  if (parts.length === 3) {
    nazev += "cel√©ho trupu";
  } else if (parts.length > 0) {
    nazev += parts.join(", ");
  }
})();`
);

// ≈°t√≠tn√°
js = js.replace(/s metabolicky aktivn√≠m nodulem k dovy≈°et≈ôen√≠/g, 'se solidn√≠m nodulem k dovy≈°et≈ôen√≠');
js = js.replace(/s metabolicky aktivn√≠mi noduly k dovy≈°et≈ôen√≠/g, 'se solidn√≠mi noduly k dovy≈°et≈ôen√≠');
    js = js.replace(/NeckThyroidText\s*\+=\s*"nodul se zv√Ω≈°enou akumulac√≠ RF/gi, 'NeckThyroidText += "solidn√≠ nodul');
    js = js.replace(/NeckThyroidText\s*\+=\s*"noduly se zv√Ω≈°enou akumulac√≠ RF/gi, 'NeckThyroidText += "solidn√≠ noduly');
	js = js.replace(/NeckThyroidText\s*\+=\s*"nodul bez zv√Ω≈°en√© akumulace RF/gi, 'NeckThyroidText += "cystick√Ω nodul');
    js = js.replace(/NeckThyroidText\s*\+=\s*"noduly bez zv√Ω≈°en√© akumulace RF/gi, 'NeckThyroidText += "cystick√© noduly');


// Nejsou p≈ô√≠tomna lo≈æiska
js = js.replace(/Jinde se patologick√° hyperakumuluj√≠c√≠ lo≈æiska nezobrazuj√≠/g, 'Jinde se z≈ôetelnƒõ patologick√° lo≈æiska nezobrazuj√≠');
js = js.replace(/Nen√≠ p≈ô√≠tomen patologick√Ω hyperakumuluj√≠c√≠ fokus, lo≈æisko ƒçi lymfadenopatie/g, 'Nejsou patrna patologick√° lo≈æiska ƒçi lymfadenopatie');
js = js.replace(/Nen√≠ p≈ô√≠tomen patologick√Ω hyperakumuluj√≠c√≠ fokus ƒçi lo≈æisko/g, 'Nejsou patrna patologick√° lo≈æiska');

// pl√≠ce noduly
js = js.replace(/drobn√Ω nespecifick√Ω nodul bez zv√Ω≈°en√© akumulace RF/g, 'drobn√Ω nespecifick√Ω nodul');
js = js.replace(/drobn√© nespecifick√© noduly bez zv√Ω≈°en√© akumulace RF/g, 'drobn√© nespecifick√© noduly');
js = js.replace(/drobn√Ω mikronodul bez zv√Ω≈°en√© akumulace RF/g, 'drobn√Ω nespecifick√Ω mikronodul');
js = js.replace(/drobn√© mikronoduly bez zv√Ω≈°en√© akumulace RF/g, 'drobn√© nespecifick√© mikronoduly');
js = js.replace(/drobn√° opacita bez zv√Ω≈°en√© akumulace RF/g, 'drobn√° nespecifick√° opacita');
js = js.replace(/drobn√© opacity bez zv√Ω≈°en√© akumulace RF/g, 'drobn√© nespecifick√© opacity');
js = js.replace(/konsolidace s n√≠zkou a≈æ st≈ôedn√≠ akumulac√≠ RF/g, 'konsolidace');

//j√°tra hemangiom
js = js.replace(/bez zv√Ω≈°en√© akumulace RF charakteru hemangiom/g, 's perif. sycen√≠m a bez washoutu charakteru hemangiom');

//nadledviny
js = js.replace(/bez zv√Ω≈°en√© akumulace RF obrazu adenom/g, 'n√≠zk√© denzity obrazu adenom');
js = js.replace(/s pod√≠lem tuku a bez zv√Ω≈°en√© akumulace RF obrazu myelolipom/g, 'tukov√© denzity obrazu myelolipom');

//ledviny
js = js.replace(/bez zv√Ω≈°en√© akumulace RF obrazu AML/g, 'obrazu AML');
js = js.replace(/fotopenick√Ω/gi, 'n√≠zkodenzn√≠'); js = js.replace(/Fotopenick√Ω/gi, 'N√≠zkodenzn√≠');
js = js.replace(/fotopenick√°/gi, 'n√≠zkodenzn√≠'); js = js.replace(/Fotopenick√°/gi, 'N√≠zkodenzn√≠');
js = js.replace(/fotopenick√©/gi, 'n√≠zkodenzn√≠'); js = js.replace(/Fotopenick√©/gi, 'N√≠zkodenzn√≠');
js = js.replace(/fotopenickou/gi, 'n√≠zkodenzn√≠'); js = js.replace(/Fotopenickou/gi, 'N√≠zkodenzn√≠');
js = js.replace(/fotopenick√Ωmi/gi, 'n√≠zkodenzn√≠mi'); js = js.replace(/Fotopenick√Ωmi/gi, 'N√≠zkodenzn√≠mi');


//dƒõloha
js = js.replace(/bez zv√Ω≈°en√© akumulace RF obrazu myom/g, 'obrazu myom');
js = js.replace(/bez zv√Ω≈°en√© akumulace RF a s kalcifikacemi obrazu myomu/g, 's kalcifikacemi obrazu myomu');

//podko≈æ√≠
js = js.replace(/infiltr√°ty s m√≠rnƒõ zv√Ω≈°enou akumulac√≠ RF v.s. postinjekƒçn√≠/g, 'nespecifick√© infiltr√°ty v.s. postinjekƒçn√≠');

//trauma skelet
js = js.replace(/se zv√Ω≈°enou akumulac√≠ RF \(recentn√≠\)/g, 's ed√©mem / odezvou okol√≠ (recentn√≠)');
js = js.replace(/bez zv√Ω≈°en√© akumulace RF \(star≈°√≠ho data\)/g, 'bez ed√©mu / odezvy okol√≠ (star≈°√≠ho data)');

//z√°nƒõt skelet
js = js.replace(/V≈°e bez v√Ωznamn√© akumulace RF\.\s*/g, '');
js = js.replace(/bez z√°nƒõtliv√© aktivace a bez zn√°mek aktivn√≠ sakroiliitidy ƒçi metabolicky aktivn√≠ entezopatie/g, 'bez zn√°mek chronick√© sakroiliitidy');

//akumulace FDG
js = js.replace(/Nelo≈æiskov√° akumulace radiofarmaka ve svalech, v gastrointestin√°ln√≠ traktu a urotraktu je p≈ô√≠tomna na podkladƒõ fyziologick√Ωch proces≈Ø ƒçi jako zcela nespecifick√Ω n√°lez.s*/g, '');
js = js.replace(/Akumulace RF vzta≈æena k referenƒçn√≠m j√°tr≈Øm.s*/g, '');

//Z√°vƒõr a popis
js = js.replace(/Hlava\/krk/g, 'Krk');
js = js.replace(/Bez zn√°mek p≈ô√≠tomnosti FDG-avidn√≠ neopl√°zie/g, 'Bez patrn√© patologie');



// NADPISY - v√Ωbƒõr vy≈°et≈ôen√≠ - jen kotva kam se to m√° d√°t.
js = js.replace(/let\s+CTWBcode\s*=\s*0\s*;/, `
(function adjustPOPText() {
  const k = !!document.getElementById('CTnadpisKRK')?.checked;
  const h = !!document.getElementById('CTnadpisHRUDNIK')?.checked;
  const b = !!document.getElementById('CTnadpisBRICHO')?.checked;
  const count = (k ? 1 : 0) + (h ? 1 : 0) + (b ? 1 : 0);

  let t = POPText.value;

  const KRK_RE     = /(^|\\r?\\n)Krk:\\s/;
  const HRUDNIK_RE = /(^|\\r?\\n)Hrudn√≠k:\\s/;
  const BRICHO_RE  = /(^|\\r?\\n)B≈ôicho:\\s/;
  const SKELET_RE  = /(^|\\r?\\n)Skelet a mƒõkk√© tk√°nƒõ:\\s/;

  const renameLine = (re, label) => {
    t = t.replace(re, \`$1\${label}\`);
  };

  if (count === 1 && k) {
    renameLine(HRUDNIK_RE, 'Hrudn√≠k v zachycen√©m rozsahu: ');
    t = t.replace(/(\\r?\\n)B≈ôicho:[\\s\\S]*?(?=\\r?\\nSkelet a mƒõkk√© tk√°nƒõ:\\s)/, '$1');
  } else if (count === 1 && h) {
    renameLine(KRK_RE, 'Krk v zachycen√©m rozsahu: ');
    renameLine(BRICHO_RE, 'Epigastrium v zachycen√©m rozsahu: ');
  } else if (count === 1 && b) {
    t = t.replace(/(^|\\r?\\n)Krk:[\\s\\S]*?(?=\\r?\\nHrudn√≠k:\\s)/, '$1');
    renameLine(HRUDNIK_RE, 'Hrudn√≠k v zachycen√©m rozsahu: ');
  } else if (count === 2 && k && h) {
    renameLine(BRICHO_RE, 'Epigastrium v zachycen√©m rozsahu: ');
  } else if (count === 2 && h && b) {
    renameLine(KRK_RE, 'Krk v zachycen√©m rozsahu: ');
  }

  t = t.replace(/\\n{3,}/g, '\\n\\n');
  POPText.value = t;
})();`
);

// üîπ Okam≈æitƒõ zobraz texty1 po naƒçten√≠ CTWB
setTimeout(() => {
  try {
    if (window.parent && window.parent.updateFinalTextAreas) {
      window.parent.updateFinalTextAreas();
      window.parent.checkAndUpdateDivVisibility();
      console.log("‚úÖ Texty1 zobrazeny automaticky po naƒçten√≠ CTWB");
    }
  } catch (e) {
    console.warn("‚ö†Ô∏è Nelze zobrazit texty1 automaticky:", e);
  }
}, 100);




          const script = document.createElement('script');
          script.textContent = js;
          document.body.appendChild(script);

          console.log("FDGPETpopis.js naƒçten a p≈ôeps√°n (PETCT ‚Üí CTWB)");
        })
        .catch(err => console.error("Chyba p≈ôi naƒç√≠t√°n√≠ FDGPETpopis.js:", err));
    })
    .catch(err => {
      document.body.innerHTML = "<p style='color:red'>Chyba p≈ôi naƒç√≠t√°n√≠ FDGPET.html</p>";
      console.error(err);
    });
</script>
</body>
</html>
