  <!-- resetProgressBar(); pro reset b√°rku p≈ôi chybƒõ  -->

<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>P√≠smenkov√° hra</title>
<style>
/* Z√°kladn√≠ tƒõlo str√°nky */
body {font-family:sans-serif;text-align:center;padding:10px;}
canvas {position:fixed;top:0;left:0;pointer-events:none;}
#fireworks {position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;background:transparent;}


/* Horn√≠ panel a menu */
.topbar {display:flex;flex-direction:column;align-items:center;gap:20px;margin-bottom:20px;margin-top:10px;}
.menu {display:flex;gap:10px;justify-content:center;}
.score-container {text-align:center;}

/* Tlaƒç√≠tka m√≥d≈Ø */
.mode-button {font-size:20px;padding:6px 12px;border:1px solid #000;border-radius:12px;cursor:pointer;transition:all 0.3s;font-weight:bold;box-shadow:2px 2px 6px rgba(0,0,0,0.2);}
.mode-button.writing {background-color:#ffcc70;color:#4b2e00;}
.mode-button.reading {background-color:#a0e8af;color:#004d25;}
.mode-button.syllables {background-color:#99ccff;color:#002b80;}
.mode-button.free {background-color:#f4c2c2;color:#6b0000;}
.mode-button:hover {transform:scale(1.05);box-shadow:4px 4px 10px rgba(0,0,0,0.3);}

/* Styl pro tlaƒç√≠tko OK (free m√≥d) */
#free-ok {width:50px;height:50px;border-radius:12px;padding:0;font-size:18px;font-weight:bold;background-color:#f4c2c2;color:#6b0000;border:1px solid #000;box-shadow:2px 2px 6px rgba(0,0,0,0.2);transition:all 0.3s;cursor:pointer;display:flex;align-items:center;justify-content:center;margin:20px auto;}
#free-ok:hover {transform:scale(1.05);box-shadow:4px 4px 10px rgba(0,0,0,0.3);}

/* R√°meƒçek obr√°zk≈Ø */
.framed-image {border:2px solid #333;max-height:200px;margin-bottom:20px;}
#image {max-height:200px;margin-bottom:20px;border-radius:12px;border:2px solid #333;}

/* Skupina jablek (pro matiku) */
.apple-group {display:flex;flex-wrap:wrap;justify-content:center;gap:4px;max-width:140px;font-size:22px;background:transparent;padding:6px;}
.apple-group div {width:24px;text-align:center;}


/* Podtr≈æ√≠tko (blikaj√≠c√≠) */
.blinking-underscore {display:inline-block;animation:blink-underscore 1.2s infinite;}
@keyframes blink-underscore {0%{opacity:1;}50%{opacity:0;}100%{opacity:1;}}

/* Sk√≥re */
.score-label {font-size:16px;margin-bottom:10px;display:block;}
.score {font-size:20px;}
.score .good {color:green;margin-right:10px;}
.score .bad {color:red;}
.score-box {display:inline-flex;align-items:center;justify-content:center;width:80px;height:40px;overflow:hidden;position:relative;}
.score-inner {font-family:Impact,sans-serif;font-weight:normal;font-size:22px;letter-spacing:1px;line-height:1;}

/* P√≠smena (psan√≠ a matika) */
.letter-box {display:inline-block;width:40px;height:40px;border:1px solid #ccc;font-size:30px;line-height:40px;margin:2px;text-align:center;vertical-align:middle;}
.correct {border-color:green;color:green;}
.incorrect {border-color:red;color:red;}

/* Animace p√≠smen a obr√°zk≈Ø */
@keyframes pop-in {0%{transform:scale(1);}40%{transform:scale(1.3);}100%{transform:scale(1);}}
.letter-pop {animation:pop-in 0.2s ease-out;}
.image-pop {animation:pop-in 0.2s ease-out;}

/* ƒåten√≠ - slovo a volby */
#reading-word {font-size:32px;margin:20px;}
#reading-options {display:flex;justify-content:center;gap:10px;flex-wrap:wrap;}
#reading-options img {height:105px;cursor:pointer;border:2px solid #333;border-radius:12px;transition:transform 0.2s ease,filter 0.3s ease,border 0.2s;}
#reading-options img:hover {transform:scale(1.05);}

/* Pokrokov√Ω pruh */
#progress-bar-container {margin-top:10px;margin-bottom:20px;width:300px;height:24px;border:2px solid #fff;margin-inline:auto;position:relative;background:linear-gradient(to right,#222,#111);border-radius:14px;box-shadow:inset 0 0 4px #000,0 0 10px #00ffc055;overflow:hidden;}
#progress-fill-green,
#progress-fill-teal,
#progress-fill-cyan,
#progress-fill-blue,
#progress-fill-purple,
#progress-fill-pink,
#progress-fill-red,
#progress-fill-orange,
#progress-fill-gold {
height:100%;
width:0%;
position:absolute;
left:0;
border-radius:12px 0 0 12px;
z-index:1;
transition:width 0.4s ease-in-out;
opacity:0.95;
}
#progress-fill-green {background:linear-gradient(to right,#00ff88,#007744);box-shadow:inset 0 0 4px #00ff88,0 0 6px #00ff88aa;z-index:1;}
#progress-fill-teal {background:linear-gradient(to right,#00ffaa,#008877);box-shadow:inset 0 0 4px #00ffaa,0 0 6px #00ffaaaa;z-index:2;}
#progress-fill-cyan {background:linear-gradient(to right,#33ccff,#0099cc);box-shadow:inset 0 0 4px #33ccff,0 0 6px #33ccffaa;z-index:3;}
#progress-fill-blue {background:linear-gradient(to right,#3399ff,#003355);box-shadow:inset 0 0 4px #3399ff,0 0 6px #3399ffaa;z-index:4;}
#progress-fill-purple {background:linear-gradient(to right,#cc66ff,#4b0066);box-shadow:inset 0 0 4px #cc66ff,0 0 6px #cc66ffaa;z-index:5;}
#progress-fill-pink {background:linear-gradient(to right,#ff99cc,#cc0066);box-shadow:inset 0 0 4px #ff99cc,0 0 6px #ff99ccaa;z-index:6;}
#progress-fill-red {background:linear-gradient(to right,#ff4444,#880000);box-shadow:inset 0 0 4px #ff4444,0 0 6px #ff4444aa;z-index:7;}
#progress-fill-orange {background:linear-gradient(to right,#ffaa33,#cc5500);box-shadow:inset 0 0 4px #ffaa33,0 0 6px #ffaa33aa;z-index:8;}
#progress-fill-gold {background:linear-gradient(to right,#ffd700,#ccaa00);box-shadow:inset 0 0 4px #ffd700,0 0 6px #ffd700aa;z-index:9;}

/* Animace ‚Äì v√Ωhra, chvƒõn√≠, pulzace */
@keyframes pop-win {0%{transform:scale(0.5) translate(-50%,-50%);opacity:0;}50%{transform:scale(1.2) translate(-50%,-50%);opacity:1;}100%{transform:scale(1) translate(-50%,-50%);opacity:1;}}
@keyframes medal-from-depth {
  0%   { transform: translate(-50%, -50%) scale(5); opacity: 0; }
  95% { transform: translate(-50%, -50%) scale(0.8); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}


.dip-effect {
  animation: screen-dip 0.5s ease-out;
}

/* Responsivita ‚Äì mobil */
@media (max-width:699px) {
#gif-container {left:10px !important;transform:none !important;}
}
@media (max-width:600px) {
body {font-size:3.5vw;}
#letters {font-size:5vw;}
#reading-options button,#free-ok {font-size:5vw;padding:2vw 4vw;}
#free-cursor {font-size:8vw;}
img {max-width:80vw;height:auto;}
#mobile-input {position:absolute;top:0;left:0;width:1px;height:1px;opacity:0.01;z-index:1;}
#main-container {padding:2vw;max-width:100vw;overflow:hidden;}
}

/* koleƒçko settings rotace */
#settings-toggle { width:48px; height:42px; font-size:24px; line-height:40px; text-align:center; display:inline-block; transform-origin:center; } #settings-toggle:hover { animation: rotate360 1s linear infinite; } @keyframes rotate360 { to { transform: rotate(360deg); } }
</style>

</head>
<body>

<!--  event. free m√≥d -->
 <div class="topbar">
<div class="menu" style="align-items: center;">
  <div style="display: flex; gap: 10px;">
    <button class="mode-button writing" onclick="startGame('writing')">‚úçÔ∏è PSAN√ç</button>
	<button class="mode-button free" style="display: none;" onclick="startGame('free')">‚úíÔ∏è VOLN√â</button>
    <button class="mode-button reading" onclick="startGame('reading')">üìñ ƒåTEN√ç</button>
    <button class="mode-button syllables" onclick="startGame('syllables')">‚ûï SLABIKY</button>
  </div>
</div>
  <div class="score-container">
    <div class="score-label">SCORE</div>
		<div class="score">
		  <div class="score-box">
			<div class="score-inner good" id="score-good">0</div>
		  </div>
		  <div class="score-box">
			<div class="score-inner bad" id="score-bad">0</div>
		  </div>
		</div>
  </div>
</div>

<div id="progress-bar-container" style="margin-top: 10px; margin-bottom: 20px; width: 300px; height: 24px; border: 2px solid #aaa; margin-inline: auto; position: relative; background: #f8f8f8; border-radius: 12px; overflow: hidden;">
  <div id="progress-fill-green"></div>
  <div id="progress-fill-teal"></div>
  <div id="progress-fill-cyan"></div>
  <div id="progress-fill-blue"></div>
  <div id="progress-fill-purple"></div>
  <div id="progress-fill-pink"></div>
  <div id="progress-fill-red"></div>
  <div id="progress-fill-orange"></div>
  <div id="progress-fill-gold"></div>
  <span style="position: absolute; right: -32px; top: 0; font-size: 24px;">üèÖ</span>
</div>



  </br>

<div id="wrong-robot-fixed" style="position:fixed;top:80px;left:50%;transform:translateX(60px);z-index:999;display:none;">  <img src="wrong-robot.gif" style="height:100px;" /></div>

<div id="gif-container" style="position:fixed;top:80px;left:50%;transform:translateX(-160px);z-index:999;display:none;"><img id="gif-animation" src="dance1.gif" style="height:100px;" /></div>


<audio id="special-audio" src="music1.mp3"></audio>


<input id="mobile-input" type="text" inputmode="text" style="position:fixed;top:50vh;left:0;width:1px;height:1px;opacity:0;border:none;z-index:-1;" />


  <img id="image" class="framed-image" src="" alt="obr√°zek" hidden />
  <div id="letters"></div>

  <div id="reading-word"></div>
  <div id="reading-options"></div>
  <div id="syllables-task"></div>


<div id="free-mode" style="display: none; margin-top: 20px;">
  <div id="free-cursor" style="font-size: 36px; width: fit-content; margin-inline: auto; padding: 5px 10px;"></div>
  <button id="free-ok" style="margin-top: 10px; font-size: 18px; width: 50px; height: 40px;">OK</button>
  <div id="free-images" style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;"></div>
</div>


<h5 id="medals-today-title" style="margin-top: 30px; margin-bottom: 6px; display: none;">MEDAILE</h5>
<div id="medals-container" style="font-size: 32px;"></div>
<div style="text-align: center; margin-top: 20px;">
  <button id="settings-toggle" style="font-size: 24px; background: none; border: none; cursor: pointer;">‚öôÔ∏è</button>
   <div id="settings" style="display: none; margin-top: 10px;">
	  <button id="toggle-uppercase" style="font-size: 24px;">üî†</button>
	  <button id="toggle-sound" style="font-size: 24px;">üîá</button>
	  <button id="toggle-free-mode" style="font-size: 24px;">‚ùåüñäÔ∏è</button>
	  <button id="toggle-kid-mode" style="font-size: 24px;">üßí</button>
	  <div id="tooltip" style="position: absolute; display: none; background: #222; color: #fff; padding: 6px 10px; border-radius: 8px; font-size: 14px; z-index: 9999; pointer-events: none;"></div>
	</div>
</div>

<div id="medal-animation" style="position: fixed; top: -100px; left: 50%; transform: translateX(-50%); font-size: 80px; z-index: 9999; pointer-events: none; display: none;"></div>


  <canvas id="fireworks"></canvas>

  <!-- Zvuky -->
  <audio id="sound-correct" src="correct.mp3"></audio>
  <audio id="sound-wrong" src="wrong.mp3"></audio>
  <audio id="sound-win" src="win.mp3"></audio>

<div id="win-banner" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:64px;font-weight:bold;color:gold;text-shadow:4px 4px 10px black;z-index:9999;display:none;animation:pop-win 1s ease-out;">VYHR√ÅL JSI!</div>

<div id="typing-log" style="display: none; white-space: pre-wrap; font-family: monospace; text-align: center; padding: 10px; margin: 10px auto; max-width: 600px;">
  <div style="margin-bottom: 10px;">
    <button onclick="resetTodayMedals()">üîÅ Reset medail√≠</button> <button onclick="plusPoint()">‚úÖ +1 bod</button> <button onclick="clearLog()">üóëÔ∏è Smazat log</button>
  </div>
</div>



  <script>

let data = [];
let writingPool = [];
let readingPool = [];
let syllablesPool = [];


// Pou≈æijeme asynchronn√≠ funkci, abychom mohli poƒçkat na naƒçten√≠ souboru
(async () => {
  try {
    const response = await fetch('WORDS/words.txt');
    if (!response.ok) {
      throw new Error(`Failed to fetch words.txt: ${response.statusText}`);
    }
    const textContent = await response.text();

    const words = textContent.split('\n').map(word => word.trim()).filter(word => word !== '');

    data = words.map(word => ({
      word: word,
      img: null 
    }));

    data.forEach(item => {
      const tryLoad = (exts, index = 0) => {
        if (index >= exts.length) return; 
        const img = new Image();
        img.onload = () => { item.img = img.src; }; 
        img.onerror = () => tryLoad(exts, index + 1); 
        img.src = `WORDS/${item.word}.${exts[index]}`;
      };
      tryLoad(['jpeg', 'jpg']); 
    });

    writingPool = [...data];
    readingPool = [...data];
    
    console.log(`Successfully loaded ${data.length} words.`);

  } catch (error) {
    console.error("Critical error loading game data:", error);
    alert("Nepoda≈ôilo se naƒç√≠st data pro hru. Zkontrolujte konzoli (F12) pro v√≠ce detail≈Ø.");
  }
})();

    let currentWord = '';
    let userInput = [];
    let scoreGood = 0;
    let scoreBad = 0;
    let isLocked = false;
	let lastInputLength = 0;
	let currentMode = null;
	let correctAnswer = null;
	let medals = { gold: 0, silver: 0, bronze: 0 };
	const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);



    function updateScoreDisplay() {
      document.getElementById('score-good').textContent = scoreGood;
      document.getElementById('score-bad').textContent = scoreBad;
    }

    function playSound(id) {
      const sound = document.getElementById(id);
      if (sound) {
        sound.currentTime = 0;
        sound.play().catch(() => {});
      }
    }

//kl√°ves. zkratky

document.addEventListener("keydown", function(e) {
  if (e.code === "F1") {
    e.preventDefault();
    logContainer.style.display = logContainer.style.display === "none" ? "block" : "none";
    return;
  }

  if (e.altKey && e.code === "KeyR") {
    resetTodayMedals();
  }

  if (e.altKey && e.code === "KeyP") {
    plusPoint();
  }

  if (e.code === "End") {
    clearLog();
    logContainer.style.display = "none";
  }
});

function plusPoint() {
  scoreGood++;
  updateScoreDisplay();
  addProgress(5);
  checkCelebrationTrigger(scoreGood);
}



// SETTINGS

let settings = {
  uppercase: false,
  sound: true,
  kidMode: false
};

function saveSettings() {
  document.cookie = `gameSettings=${JSON.stringify(settings)};path=/;max-age=31536000`;
}

function loadSettings() {
  const match = document.cookie.match(/gameSettings=([^;]+)/);
  if (match) {
    try {
      settings = JSON.parse(match[1]);
    } catch {}
  }
  applySettings();
}

function applySettings() {
  document.getElementById("toggle-uppercase").textContent = settings.uppercase ? "üî†" : "üî°";
  document.getElementById("toggle-sound").textContent = settings.sound ? "üîä" : "üîá";
  document.getElementById("toggle-kid-mode").textContent = settings.kidMode ? "üë∂" : "üßí";

  const uppercaseStyle = settings.uppercase ? "uppercase" : "none";
  ["mobile-input", "reading-word", "letters"].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.textTransform = uppercaseStyle;
  });
}

document.getElementById("settings-toggle").addEventListener("click", () => {
  const s = document.getElementById("settings");
  s.style.display = s.style.display === "none" ? "block" : "none";
});

document.getElementById("toggle-uppercase").addEventListener("click", () => {
  settings.uppercase = !settings.uppercase;
  saveSettings();
  applySettings();
  showTooltip(event.currentTarget, settings.uppercase ? "VELK√Å P√çSMENA" : "mal√° p√≠smena");
});

document.getElementById("toggle-sound").addEventListener("click", () => {
  settings.sound = !settings.sound;
  saveSettings();
  applySettings();
  showTooltip(event.currentTarget, settings.sound ? "zvuk ON" : "zvuk OFF");
});

document.getElementById("toggle-free-mode").addEventListener("click", (e) => {
  const btn = document.getElementById("toggle-free-mode");
  const freeBtn = document.querySelector(".mode-button.free");

  const isActive = btn.textContent === "‚úÖüñäÔ∏è";
  if (isActive) {
    btn.textContent = "‚ùåüñäÔ∏è";
    freeBtn.style.display = "none";
    showTooltip(btn, "voln√© psan√≠ NEaktivn√≠");
  } else {
    btn.textContent = "‚úÖüñäÔ∏è";
    freeBtn.style.display = "inline-block";
    showTooltip(btn, "voln√© psan√≠ AKTIVN√ç");
  }
});

document.getElementById("toggle-kid-mode").addEventListener("click", () => {
  settings.kidMode = !settings.kidMode;
  saveSettings();
  applySettings();
  showTooltip(event.currentTarget, settings.kidMode ? "miminƒç√≠ m√≥d" : "dƒõtsk√Ω m√≥d");
});




// Zmƒõ≈à existuj√≠c√≠ playSound funkci:
function playSound(id) {
  if (!settings.sound) return;
  if (settings.kidMode && id === 'sound-wrong') return;

  const sound = document.getElementById(id);
  if (sound) {
    sound.currentTime = 0;
    sound.play().catch(() => {});
  }
}

loadSettings();

function showTooltip(button, text) {
  const tooltip = document.getElementById("tooltip");
  tooltip.textContent = text;

  const rect = button.getBoundingClientRect();
  tooltip.style.left = `${rect.left + window.scrollX}px`;
  tooltip.style.top = `${rect.bottom + window.scrollY + 4}px`;
  tooltip.style.display = "block";

  setTimeout(() => {
    tooltip.style.display = "none";
  }, 1000);
}



//START

function startGame(mode) {
  currentMode = mode;

  // Odpojit v≈°echny kl√°vesnicov√© re≈æimy
  document.removeEventListener('keydown', handleKey);

  // Vyƒçistit a skr√Ωt v≈°e
  document.getElementById('image').hidden = true;
  document.getElementById('letters').style.display = 'none';
  document.getElementById('letters').innerHTML = '';
  document.getElementById('reading-word').textContent = '';
  document.getElementById('reading-options').innerHTML = '';
  document.getElementById('syllables-task').innerHTML = '';
  document.getElementById('free-mode').style.display = 'none';
  document.getElementById('free-images').innerHTML = '';

  // Reset inputu
  userInput = [];
  lastInputLength = 0;
  isLocked = false;

  if (mode === 'writing') {
    writingPool = [...data];
    loadRandom();
    document.getElementById('image').hidden = false;
    document.getElementById('letters').style.display = 'block';
    document.addEventListener('keydown', handleKey);

  } else if (mode === 'reading') {
    readingPool = [...data];
    loadReadingTask();

	} else if (mode === 'syllables') {
	  syllablesPool = [...data]; // ‚¨ÖÔ∏è nov√Ω ≈ô√°dek
	  loadsyllablesTask();
	  document.addEventListener('keydown', handlesyllablesKey);


  } else if (mode === 'free') {
    document.getElementById('free-mode').style.display = 'block';
    updateFreeCursor();
  }

  // V≈ædy aktivuj vstup na mobilu (pro v≈°echny m√≥dy s psan√≠m)
  if (mode === 'writing' || mode === 'syllables' || mode === 'free') {
    setTimeout(() => {
      const input = document.getElementById('mobile-input');
      input.focus();
    }, 100);
  }
}



    function loadRandom() {
      if (writingPool.length === 0) {
        alert("V≈°echna slova byla pou≈æita!");
        return;
      }
      const index = Math.floor(Math.random() * writingPool.length);
      const random = writingPool.splice(index, 1)[0];
      currentWord = random.word;
      userInput = [];
      isLocked = false;

      const img = document.getElementById('image');
      img.src = random.img;
      img.hidden = false;

      const lettersDiv = document.getElementById('letters');
      lettersDiv.innerHTML = '';

      for (let i = 0; i < currentWord.length; i++) {
        const span = document.createElement('span');
        span.className = 'letter-box';
        span.textContent = '';
        lettersDiv.appendChild(span);
      }
    }

    function handleKey(e) {
      if (e.repeat || isLocked) return;

      const key = e.key;
      const index = userInput.length;

      if (key.length === 1 && key.match(/[a-zA-Z√°-≈æ√Å-≈Ω]/i)) {
        if (index < currentWord.length) {
          const correctChar = currentWord[index];
		  appendToLog(key, key.toLowerCase() === correctChar.toLowerCase());


          if (key.toLowerCase() === correctChar.toLowerCase()) {
            userInput.push(key);
            scoreGood++; addProgress(1); checkCelebrationTrigger(scoreGood);
            playSound('sound-correct');
            updateScoreDisplay();
            updateDisplay();
          } else {
            userInput.push(key);
            scoreBad++; //resetProgressBar();
			if (!settings.kidMode) resetProgressBar();
            playSound('sound-wrong');
			showWrongRobot();
            updateScoreDisplay();
            updateDisplay();

            isLocked = true;
            setTimeout(() => {
              if (userInput[index]?.toLowerCase() !== correctChar.toLowerCase()) {
                userInput.splice(index, 1);
                updateDisplay();
              }
              isLocked = false;
            }, 1000);
          }
        }
		} else if (e.key === 'Backspace') {
		  if (currentMode === 'writing') {
			userInput.pop();
			scoreGood = Math.max(0, scoreGood - 1);
			updateScoreDisplay();
			updateDisplay();
		  } else {
			userInput.pop();
			updateDisplay();
		  }
		}

    }


function updateDisplay() {
  const letters = document.getElementById('letters').children;

  for (let i = 0; i < currentWord.length; i++) {
    const box = letters[i];
    const inputChar = userInput[i];

    box.textContent = inputChar || '';

    if (!inputChar) {
      box.className = 'letter-box';
    } else if (inputChar.toLowerCase() === currentWord[i].toLowerCase()) {
      box.className = 'letter-box correct';
    } else {
      box.className = 'letter-box incorrect';
    }

    // Poskoƒçen√≠ pouze p≈ôi nov√©m zad√°n√≠ znaku (ne p≈ôi maz√°n√≠)
    if (i === userInput.length - 1 && inputChar && userInput.length > lastInputLength) {
      box.classList.add('letter-pop');
      box.addEventListener('animationend', () => {
        box.classList.remove('letter-pop');
      }, { once: true });
    }
  }

  // Pokud je cel√© slovo spr√°vnƒõ
  if (
    userInput.length === currentWord.length &&
    userInput.join('').toLowerCase() === currentWord.toLowerCase()
  ) {
    playSound('sound-win');
	newLogLine();
    launchFireworks();
    isLocked = true;
    setTimeout(() => {
      stopFireworks();
      if (currentMode === 'writing') {
        loadRandom();
        isLocked = false;
      }
    }, 2000);
  }

  // Z√°znam d√©lky vstupu pro dal≈°√≠ srovn√°n√≠
  lastInputLength = userInput.length;
}



    function loadReadingTask() {
      if (readingPool.length === 0) {
        alert("V≈°echna slova byla p≈ôeƒçtena!");
        return;
      }
      const index = Math.floor(Math.random() * readingPool.length);
      const correct = readingPool.splice(index, 1)[0];
      currentWord = correct.word;

      document.getElementById('reading-word').textContent = currentWord;
      const container = document.getElementById('reading-options');
      container.innerHTML = '';

      const shuffled = [...data]
        .filter(item => item.word !== currentWord)
        .sort(() => 0.5 - Math.random())
        .slice(0, 4);

      shuffled.push(correct);
      shuffled.sort(() => 0.5 - Math.random());

      shuffled.forEach(item => {
        const img = document.createElement('img');
        img.src = item.img;
        img.alt = item.word;
        img.style.filter = '';
        img.addEventListener('mouseenter', () => img.style.border = '2px solid blue');
        img.addEventListener('mouseleave', () => img.style.border = '2px solid #333');
        img.addEventListener('click', () => handleReadingClick(img, item.word === currentWord));
        container.appendChild(img);
      });
    }

    function handleReadingClick(img, isCorrect) {
	
		// Animace poskoƒçen√≠ obr√°zku
	img.classList.add('image-pop');
	img.addEventListener('animationend', () => {
	  img.classList.remove('image-pop');
	}, { once: true });

      const all = document.querySelectorAll('#reading-options img');
      all.forEach(el => el.style.pointerEvents = 'none');

      if (isCorrect) {
		  img.style.filter = 'brightness(0.6) sepia(1) hue-rotate(90deg) saturate(4)';
		  scoreGood++; addProgress(3); checkCelebrationTrigger(scoreGood);
		  updateScoreDisplay();
		  playSound('sound-win');
		  launchFireworks();
		  setTimeout(() => {
			stopFireworks();
			if (currentMode === 'reading') {
			  loadReadingTask();
			}
		  }, 2000);
		} else {
		  img.style.filter = 'brightness(0.5) sepia(1) hue-rotate(-50deg) saturate(5)';
		  scoreBad++; //resetProgressBar();
		  if (!settings.kidMode) resetProgressBar();
		  updateScoreDisplay();
		  playSound('sound-wrong');
		  showWrongRobot();

		  // Znovupovolen√≠ klik√°n√≠ na ostatn√≠ obr√°zky
		  setTimeout(() => {
			const all = document.querySelectorAll('#reading-options img');
			all.forEach(el => el.style.pointerEvents = 'auto');
		  }, 1000);
		}
    }





const canvas = document.getElementById('fireworks');
const ctx = canvas.getContext('2d');
let fireworks = [];
let fireworksInterval;

function launchFireworks() {
  resizeCanvas();
  fireworks = [];
  for (let i = 0; i < 5; i++) {
    fireworks.push(createFirework());
  }
  fireworksInterval = setInterval(updateFireworks, 50);
}

function stopFireworks() {
  clearInterval(fireworksInterval);
  fireworks = [];
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function createFirework() {
  const colors = ['#ff3333', '#33cc33', '#3399ff', '#ffff33', '#ff66cc', '#00ffff'];
  const x = Math.random() * canvas.width;
  const y = Math.random() * canvas.height / 2;
  const color = colors[Math.floor(Math.random() * colors.length)];
  const particles = [];

  for (let i = 0; i < 40; i++) {
    const angle = Math.random() * Math.PI * 2;
    const speed = Math.random() * 5 + 2;
    particles.push({
      x, y,
      dx: Math.cos(angle) * speed,
      dy: Math.sin(angle) * speed,
      alpha: 1,
      color
    });
  }

  return { particles };
}


//syllables

function loadsyllablesTask() {
  if (syllablesPool.length === 0) {
    alert("V≈°echna slova byla pou≈æita!");
    return;
  }

  const index = Math.floor(Math.random() * syllablesPool.length);
  const wordObj = syllablesPool.splice(index, 1)[0];

  currentWord = wordObj.word;
  const container = document.getElementById('syllables-task');
  container.innerHTML = '';

  const wordWrapper = document.createElement('div');
  wordWrapper.style.display = 'flex';
  wordWrapper.style.justifyContent = 'center';
  wordWrapper.style.gap = '0px';
  wordWrapper.style.fontSize = '36px';
  wordWrapper.style.position = 'relative';

  for (let i = 0; i < currentWord.length; i++) {
    const letterSpan = document.createElement('span');
    letterSpan.textContent = settings.uppercase
	  ? currentWord[i].toUpperCase()
	  : currentWord[i].toLowerCase();

	letterSpan.dataset.index = i;
	letterSpan.style.cursor = 'pointer';

	letterSpan.addEventListener('mousemove', (e) => {
	  const rect = letterSpan.getBoundingClientRect();
	  const middle = rect.left + rect.width / 2;
	  const index = parseInt(letterSpan.dataset.index, 10);

	  if (e.clientX < middle) {
		highlightDivider(index);       // lev√° p≈Ølka p√≠smene
	  } else {
		highlightDivider(index + 1);   // prav√° p≈Ølka p√≠smene
	  }
	});

letterSpan.addEventListener('click', (e) => {
  const rect = letterSpan.getBoundingClientRect();
  const middle = rect.left + rect.width / 2;
  const index = parseInt(letterSpan.dataset.index, 10);
  const dividerIndex = e.clientX < middle ? index : index + 1;

  const divider = document.querySelector(`.divider[data-index="${dividerIndex}"]`);
  if (divider) {
    divider.classList.toggle('active');
    divider.style.backgroundColor = divider.classList.contains('active') ? 'black' : 'transparent';
  }
});


	letterSpan.addEventListener('mouseleave', () => {
	  clearDividerHighlights();
	});

    wordWrapper.appendChild(letterSpan);

    if (i < currentWord.length - 1) {
      const divider = document.createElement('div');
      divider.className = 'divider';
      divider.dataset.index = i + 1;
      divider.style.width = '10px';
      divider.style.height = '40px';
      divider.style.backgroundColor = 'transparent';
      divider.style.transition = 'background 0.2s';
      divider.style.cursor = 'pointer';

      divider.addEventListener('mouseenter', () => {
        if (!divider.classList.contains('active')) {
          divider.style.backgroundColor = 'lightgray';
        }
      });

      divider.addEventListener('mouseleave', () => {
        if (!divider.classList.contains('active')) {
          divider.style.backgroundColor = 'transparent';
        }
      });

      divider.addEventListener('click', () => {
        divider.classList.toggle('active');
        divider.style.backgroundColor = divider.classList.contains('active') ? 'black' : 'transparent';
      });

      wordWrapper.appendChild(divider);
    }
  }

  container.appendChild(wordWrapper);

  const okButton = document.createElement('button');
  okButton.textContent = 'OK';
  okButton.style.marginTop = '20px';
  okButton.className = 'mode-button syllables';
  okButton.onclick = () => evaluateSyllables(currentWord);
  container.appendChild(okButton);
}


function highlightDivider(index) {
  document.querySelectorAll('.divider').forEach(div => {
    if (!div.classList.contains('active')) {
      div.style.backgroundColor = 'transparent';
    }
  });

  const div = document.querySelector(`.divider[data-index="${index}"]`);
  if (div && !div.classList.contains('active')) {
    div.style.backgroundColor = 'lightgray';
  }
}

function clearDividerHighlights() {
  document.querySelectorAll('.divider').forEach(div => {
    if (!div.classList.contains('active')) {
      div.style.backgroundColor = 'transparent';
    }
  });
}


function splitToSyllables(word) {
  // P≈ôevod na mal√° p√≠smena a oznaƒçen√≠ digraf≈Ø/diphtong≈Ø
  let w = word.toLowerCase()
    .replace(/ch/g, '√á')    // digraf ch
    .replace(/au/g, '√Ñ')    // diphtong au
    .replace(/ou/g, '√ñ')    // diphtong ou
    .replace(/ie/g, '√é');   // diphtong ie

  const letters = Array.from(w);
  const vowels = new Set('aeiouy√°√©ƒõ√≠√≥√∫≈Ø√Ω√Ñ√ñ√é'.split(''));

  // P≈ôid√°me bƒõ≈æn√© ƒçesk√© poƒç√°teƒçn√≠ dvoup√≠smenn√© shluky
  const onsetClusters = new Set([
    'bl','br','pl','pr','kl','kr','fl','fr','gl','gr',
    'dr','tr','vr','vl','zr','zl','sm','sn','sl',
    'hr'
  ]);

  // Speci√°ln√≠ pravidlo: pokud slovo zaƒç√≠n√° jedn√≠m z onsetClusters,
  // n√°sleduje dal≈°√≠ souhl√°ska a celkovƒõ m√° pr√°vƒõ jednu samohl√°sku,
  // rozdƒõl ho hned za t√≠m poƒç√°teƒçn√≠m shlukem.
  const wLower = word.toLowerCase();
  const initial2 = wLower.slice(0, 2);
  const vowelCount = letters.filter(c => vowels.has(c)).length;
  const thirdChar = wLower.charAt(2);
  if (onsetClusters.has(initial2) && !vowels.has(thirdChar) && vowelCount === 1) {
    return [ word.slice(0,2), word.slice(2) ];
  }

  const syllables = [];
  let start = 0, n = letters.length;

  while (true) {
    // najdi prvn√≠ samohl√°sku (nucleus)
    let vpos = -1;
    for (let i = start; i < n; i++) {
      if (vowels.has(letters[i])) { vpos = i; break; }
    }
    if (vpos === -1) {
      // ≈æ√°dn√° dal≈°√≠ samohl√°ska ‚Üí p≈ôipoj zbytek k posledn√≠ slabice
      if (start < n) {
        const tail = letters.slice(start).join('');
        if (syllables.length) {
          syllables[syllables.length - 1] += tail;
        } else {
          syllables.push(tail);
        }
      }
      break;
    }

    // najdi dal≈°√≠ samohl√°sku
    let vpos2 = -1;
    for (let i = vpos + 1; i < n; i++) {
      if (vowels.has(letters[i])) { vpos2 = i; break; }
    }
    if (vpos2 === -1) {
      const remaining = letters.slice(start);

      // pouze kontrola na konci slova:
      // pokud zbytek konƒç√≠ platn√Ωm shlukem, rozdƒõl p≈ôed n√≠m
      if (remaining.length > 2) {
        const last2 = remaining.slice(-2).join('');
        if (onsetClusters.has(last2)) {
          syllables.push(remaining.slice(0, remaining.length - 2).join(''));
          syllables.push(last2);
          break;
        }
      }

      // jinak cel√Ω zbytek jako jedna slabika
      syllables.push(remaining.join(''));
      break;
    }

    // VCV nebo VCC‚Ä¶CV?
    const ccount = vpos2 - vpos - 1;
    const splitPos = (ccount <= 1) ? vpos : vpos + 1;
    syllables.push(letters.slice(start, splitPos + 1).join(''));
    start = splitPos + 1;
  }

  // navr√°tit origin√°ln√≠ digrafy/diphtongy
  return syllables.map(s =>
    s.replace(/√á/g, 'ch')
     .replace(/√Ñ/g, 'au')
     .replace(/√ñ/g, 'ou')
     .replace(/√é/g, 'ie')
  );
}



function evaluateSyllables(originalWord) {
  const correct = splitToSyllables(originalWord);
  const expectedPositions = [];
  let count = 0;

  for (let i = 0; i < correct.length - 1; i++) {
    count += correct[i].length;
    expectedPositions.push(count);
  }

  const clickedDividers = Array.from(document.querySelectorAll('.divider.active'))
    .map(div => parseInt(div.dataset.index));

  const correctSet = new Set(expectedPositions);
  const userSet = new Set(clickedDividers);
  const allDividers = document.querySelectorAll('.divider');

  // ‚úÖ SPR√ÅVN√â ROZDƒöLEN√ç
  if (arraysEqual([...userSet].sort(), [...correctSet].sort())) {
    scoreGood += 3;
    addProgress(3);
    playSound("sound-win");
    launchFireworks();
	

    allDividers.forEach(div => {
      if (userSet.has(parseInt(div.dataset.index))) {
        div.style.backgroundColor = 'green';
      }
    });

    // üî° Oddƒõlen√≠ slabik
    const letters = document.querySelectorAll('#syllables-task div span');
    correctSet.forEach(pos => {
      if (letters[pos - 1]) {
        letters[pos - 1].style.marginRight = '20px';
        letters[pos - 1].style.transition = 'margin 0.3s';
      }
    });

    updateScoreDisplay();

    setTimeout(() => {
      stopFireworks();
      loadsyllablesTask();
    }, 3000);

  } else {
    // ‚ùå ≈†PATN√â ROZDƒöLEN√ç
    scoreBad += 1;
    if (!settings.kidMode) resetProgressBar();
    playSound("sound-wrong");
    showWrongRobot();
    updateScoreDisplay();
	speakSyllables(correct); 

    allDividers.forEach(div => {
      const pos = parseInt(div.dataset.index);
      if (userSet.has(pos)) {
        div.style.backgroundColor = correctSet.has(pos) ? 'green' : 'red';
      } else if (correctSet.has(pos)) {
        div.style.backgroundColor = 'red';
      }
    });

    setTimeout(() => {
      allDividers.forEach(div => {
        div.classList.remove('active');
        div.style.backgroundColor = 'transparent';
      });
    }, 1000); // reset
  }
}


function arraysEqual(a, b) {
  return a.length === b.length && a.every((val, i) => val === b[i]);
}


function handlesyllablesKey(e) {
  if (e.key === 'Enter') {
    evaluateSyllables(currentWord);
  }
}


//fireworks

function updateFireworks() {
  ctx.clearRect(0, 0, canvas.width, canvas.height); // nesma≈æe zbytek str√°nky

  fireworks.forEach(firework => {
    firework.particles.forEach(p => {
      p.x += p.dx;
      p.y += p.dy;
      p.alpha -= 0.02;
    });

    firework.particles = firework.particles.filter(p => p.alpha > 0);
  });

  fireworks = fireworks.filter(f => f.particles.length > 0);

  fireworks.forEach(firework => {
    firework.particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 3, 0, 2 * Math.PI);
      ctx.fillStyle = p.color;
      ctx.globalAlpha = p.alpha;
      ctx.fill();
    });
  });

  ctx.globalAlpha = 1;
}


function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

window.addEventListener('resize', resizeCanvas);


document.getElementById('mobile-input').addEventListener('input', (e) => {
  if (!isMobile) return;
  const char = e.target.value;
  e.target.value = '';

  if (currentMode === 'writing') {
    handleKey({ key: char });
  } else if (currentMode === 'syllables') {
    handleMathKey({ key: char });
  } else if (currentMode === 'free') {
    const okButton = document.getElementById("free-ok");
    if (okButton.textContent !== "OK") {
      resetFreeSection();
    }
    if (char.length === 1 && char.match(/[a-zA-Z√°-≈æ√Å-≈Ω]/i) && userInput.length < 10) {
      userInput.push(char);
      updateFreeCursor();
    }
  }
});



// animace tanec
let lastCelebrationScore = 0;

function checkCelebrationTrigger(score) {
  if (score > 0 && score % 100 === 0 && score !== lastCelebrationScore) {
    lastCelebrationScore = score;

    const medalAudio = new Audio("medal.mp3");
    medalAudio.play().catch(() => {});

    updateScoreStyle(); // zvƒõt≈°en√≠ ƒç√≠sla
  }
}


// wrong robot

function showWrongRobot() {
  if (settings.kidMode) return;
  const robot = document.getElementById("wrong-robot-fixed");
  if (!robot) return;
  robot.style.display = "block";
  setTimeout(() => {
    robot.style.display = "none";
  }, 1300);
}





// TADY TADY TADY TADY																						TADY TADY animace POƒåET 

function showCelebration() {
  const gifContainer = document.getElementById('gif-container');
  const gif = document.getElementById('gif-animation');

  // === Animace ===
  const gifCount = 13; // nap≈ô. dance1.gif a≈æ dance5.gif
  const randomGif = Math.floor(Math.random() * gifCount) + 1;
  gif.src = `dance${randomGif}.gif`;

  // === Hudba ===
  const musicCount = 7; // nap≈ô. music1.mp3 a≈æ music4.mp3
  const randomMusic = Math.floor(Math.random() * musicCount) + 1;
  const audio = new Audio(`music${randomMusic}.mp3`);
  audio.volume = 1;
  audio.play().catch(() => {});

  // Zobrazit animaci
  gifContainer.style.display = 'block';

  // Spustit fade-out ve 4. sekundƒõ
  setTimeout(() => {
    const fadeInterval = setInterval(() => {
      if (audio.volume > 0.05) {
        audio.volume -= 0.05;
      } else {
        audio.volume = 0;
        audio.pause();
        clearInterval(fadeInterval);
      }
    }, 50); // ka≈æd√Ωch 50 ms sn√≠≈æ√≠ hlasitost
  }, 4000);

  // Skryj animaci po 5 sekund√°ch
  setTimeout(() => {
    gifContainer.style.display = 'none';
  }, 5000);
}



// Zvƒõt≈°ov√°n√≠ sk√≥re

function updateScoreStyle() {
  const el = document.getElementById('score-good');
  const baseSize = 20;
  const layers = Math.floor(scoreGood / 10);

  // Nov√° velikost p√≠sma (4px za ka≈æd√Ωch 10 bod≈Ø)
  el.style.fontSize = `${baseSize + 1 * layers}px`;

  // Generov√°n√≠ vrstven√©ho ≈ælut√©ho obrysu se zvy≈°uj√≠c√≠ se svƒõtelnost√≠
  const colors = ['#FFD700', '#FF4444', '#AA66CC', '#33B5E5', '#99CC00', '#FF8800']; // ≈ælut√°, ƒçerven√°, fialov√°, modr√°, zelen√°, oran≈æov√°
  const outline = [];

  for (let i = 1; i <= layers; i++) {
    const offset = 1 * i;
    const color = colors[(i - 1) % colors.length]; // cyklick√© barvy

    outline.push(
      `${offset}px ${offset}px 0 ${color}`,
      `-${offset}px ${offset}px 0 ${color}`,
      `${offset}px -${offset}px 0 ${color}`,
      `-${offset}px -${offset}px 0 ${color}`
    );
  }

  el.style.textShadow = outline.join(', ');

}


let lastStyleScore = 0;

function checkScoreStyleUpdate() {
  if (scoreGood !== lastStyleScore && scoreGood % 10 === 0) {
    lastStyleScore = scoreGood;
    updateScoreStyle();
  }
}

setInterval(checkScoreStyleUpdate, 500);

// ACHIEVEMENTS 

let progressPoints = 0;
let progressLayer = 0;
const maxLayer = 9;

function addProgress(points) {
  progressPoints += points;

  if (progressPoints >= 15) {
    if (progressLayer === 8) {
      showWinBanner(); // konec cyklu ‚Üí v√Ωhra!
    }

    progressPoints = 0;
    addMedal();
    progressLayer = (progressLayer + 1) % maxLayer;
  }

  updateProgressBar();
  saveMedals();
}


function updateProgressBar() {
  const percent = (progressPoints / 15) * 100;
  const fillIds = [
    "progress-fill-green",
    "progress-fill-teal",
	"progress-fill-cyan",
    "progress-fill-blue",
    "progress-fill-purple",
    "progress-fill-pink",
    "progress-fill-red",
    "progress-fill-orange",
    "progress-fill-gold"
  ];

  fillIds.forEach((id, index) => {
    const fill = document.getElementById(id);
    if (!fill) return;

    fill.style.width =
      index < progressLayer
        ? "100%"
        : index === progressLayer
        ? `${percent}%`
        : "0%";
  });
}

function resetProgressBar() {
  progressPoints = 0;
  progressLayer = 0;
  updateProgressBar();
}

// MEDAILE

function addMedal() {
  medals.bronze += 1;

  while (medals.bronze >= 3) {
    medals.bronze -= 3;
    medals.silver += 1;
  }
  while (medals.silver >= 3) {
    medals.silver -= 3;
    medals.gold += 1;
  }

  // Spust√≠ animaci a a≈æ po jej√≠m konci aktualizuje ≈ô√°dek medail√≠
  animateMedal("bronze", () => {
    updateMedals();
    saveMedals();
    showCelebration();
  });
}


function updateMedals() {
  const container = document.getElementById("medals-container");
  container.innerHTML =
    "ü•á".repeat(medals.gold) +
    "ü•à".repeat(medals.silver) +
    "ü•â".repeat(medals.bronze);

  const hasAny = medals.gold || medals.silver || medals.bronze;
  document.getElementById("medals-today-title").style.display = hasAny ? "block" : "none";
}



function saveMedals() {
  document.cookie = `medals=${JSON.stringify(medals)};path=/;max-age=31536000`;
}

function loadMedals() {
  const match = document.cookie.match(/medals=([^;]+)/);
  if (match) {
    try {
      medals = JSON.parse(match[1]);
      updateMedals();
    } catch {}
  }
}

loadMedals();
updateProgressBar();


// ANIMACE medaile

function animateMedal(type, onComplete = null) {
  const anim = document.getElementById("medal-animation");
  const emoji = type === "gold" ? "ü•á" : type === "silver" ? "ü•à" : "ü•â";
  const container = document.getElementById("medals-container");
  const rect = container.getBoundingClientRect();
  const targetLeft = rect.left + rect.width / 2;
  const targetTop = rect.top + window.scrollY;

  anim.textContent = emoji;
  anim.style.display = "block";
  anim.style.opacity = "1";
  anim.style.position = "absolute";
  anim.style.left = `${targetLeft}px`;
  anim.style.top = `${targetTop}px`;
  anim.style.transform = "translate(-50%, -50%) scale(1)";
  anim.style.animation = "medal-from-depth 1s ease-out forwards";

  // A≈æ skonƒç√≠ animace, zobraz medaili v ≈ô√°dku
  setTimeout(() => {
    anim.style.display = "none";
    if (typeof onComplete === "function") onComplete();
  }, 1000); // Doba odpov√≠d√° d√©lce animace
}





// reset medail√≠
function resetTodayMedals() {
  medals = { gold: 0, silver: 0, bronze: 0 };
  saveMedals();
  updateMedals();
  console.log("Dne≈°n√≠ medaile byly resetov√°ny.");
}

// v√≠tƒõz

function showWinBanner() {
  const banner = document.getElementById("win-banner");
  banner.textContent = "üéâ V√çTƒöZ! üéâ";
  banner.style.display = "block";

  let danceIndex = 1;
  let musicIndex = 1;
  const maxDances = 8;
  const maxMusic = 5;
  let cycleInterval;

  const gifContainer = document.getElementById("gif-container");
  const gif = document.getElementById("gif-animation");

  const audio = new Audio();
  audio.volume = 1;

  function cycleCelebration() {
    // Zmƒõna GIFu
    gif.src = `dance${danceIndex}.gif`;
    gifContainer.style.display = "block";

    // Zmƒõna hudby
    audio.pause();
    audio.src = `music${musicIndex}.mp3`;
    audio.currentTime = 0;
    audio.play().catch(() => {});

    // Dal≈°√≠ iterace
    danceIndex = (danceIndex % maxDances) + 1;
    musicIndex = (musicIndex % maxMusic) + 1;
  }


	setTimeout(() => {
	  cycleCelebration();
	  cycleInterval = setInterval(cycleCelebration, 6000);
	}, 7000);

  // Ukonƒçen√≠ cel√© show po 20 vte≈ôin√°ch
  setTimeout(() => {
    clearInterval(cycleInterval);
    audio.pause();
    gifContainer.style.display = "none";
    banner.style.display = "none";
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }, 60000);
}



// FREESTYLE

function resetFreeSection() {
  document.getElementById("free-ok").textContent = "OK";
  document.getElementById("free-ok").style.backgroundColor = "";
  document.getElementById("free-images").innerHTML = "";
  userInput = [];
  updateFreeCursor();
}


function updateFreeCursor() {
  const cursor = document.getElementById('free-cursor');
  cursor.innerHTML = userInput.join('') +
    (userInput.length < 10 ? '<span class="blinking-underscore">_</span>' : '');
}

document.addEventListener("keydown", function(e) {
  if (currentMode === 'free' && e.key === 'Enter') {
    const btn = document.getElementById("free-ok");
    btn.click();
  }
});

document.addEventListener("keydown", function(e) {
  if (currentMode !== 'free') return;

  // Reset po p≈ôedchoz√≠m potvrzen√≠ slova
  const okButton = document.getElementById("free-ok");
  if (okButton.textContent !== "OK") {
    resetFreeSection();
  }

  // Z√°pis p√≠smen
  if (e.key.length === 1 && e.key.match(/[a-zA-Z√°-≈æ√Å-≈Ω]/i) && userInput.length < 10) {
    userInput.push(e.key);
    updateFreeCursor();
  } else if (e.key === 'Backspace') {
    userInput.pop();
    updateFreeCursor();
  }
});


document.getElementById("free-ok").addEventListener("click", async () => {
  const word = userInput.join('').toLowerCase();
  if (!word) return;

  const btn = document.getElementById("free-ok");

  try {
    const response = await fetch("slovnikCJ.txt");
    const text = await response.text();
    const words = text.split('\n').map(w => w.trim());

    if (words.includes(word)) {
      const points = word.length;
      scoreGood += points;
      addProgress(points);
      playSound("sound-win");
      updateScoreDisplay();
      launchFireworks();
      btn.style.backgroundColor = "green";
      btn.textContent = `+${points}`;
      showImages(word);

      // ‚ö†Ô∏è RESET po spr√°vn√©m slovƒõ
      setTimeout(() => {
        stopFireworks();
        resetFreeSection();  // sma≈æe input, obr√°zky, tlaƒç√≠tko
        document.getElementById('mobile-input').focus();
      }, 3000);

    } else {
      scoreBad++;
	  if (!settings.kidMode) resetProgressBar();
      resetProgressBar();
      playSound("sound-wrong");
      showWrongRobot();
      updateScoreDisplay();
      btn.style.backgroundColor = "red";
      btn.textContent = "‚úó";
    }
  } catch (err) {
    alert("Chyba p≈ôi naƒç√≠t√°n√≠ slovn√≠ku.");
  }
});



async function showImages(word) {
  const container = document.getElementById("free-images");
  container.innerHTML = '';

  try {
    const response = await fetch(`https://abeceda-production.up.railway.app/images?q=${encodeURIComponent(word)}`);
    const data = await response.json();

    console.log("üîç Bing dotaz:", data.query);

    data.images.forEach(url => {
      const img = document.createElement("img");
      img.src = url;
      img.alt = word;
      img.style.height = "120px";
      img.style.margin = "0 5px";
      img.style.border = "2px solid #444";
      img.style.borderRadius = "8px";
      container.appendChild(img);
    });

  } catch (err) {
    console.error("‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ obr√°zk≈Ø:", err);
    container.textContent = "Obr√°zky se nepoda≈ôilo naƒç√≠st.";
  }
}



const logContainer = document.getElementById("typing-log");

function appendToLog(char, isCorrect) {
  const span = document.createElement("span");
  span.textContent = char;
  span.style.color = isCorrect ? "green" : "red";
  logContainer.appendChild(span);
}

function newLogLine() {
  logContainer.appendChild(document.createElement("br"));
}

function clearLog() {
  logContainer.innerHTML = "";
}


async function speakSyllables(syllables) {
  // ƒçekej 2 sekundy po p≈ôehr√°n√≠ zvuku
  await new Promise(resolve => setTimeout(resolve, 1000));

  for (let syllable of syllables) {
    const utterance = new SpeechSynthesisUtterance(syllable);
    utterance.lang = 'cs-CZ';
	utterance.lang = 'cs-CZ';
    utterance.volume = 1;         // max hlasitost
    utterance.rate = 2;           // norm√°ln√≠ rychlost
    utterance.pitch = 1.1;        // tro≈°ku vy≈°≈°√≠ t√≥n
    speechSynthesis.speak(utterance);
    await new Promise(resolve => setTimeout(resolve, 10)); // pauza 5s mezi slabikami
  }
}


  </script>
</body>
</html>
